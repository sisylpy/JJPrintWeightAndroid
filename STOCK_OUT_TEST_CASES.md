# 4种出库模式测试用例

## 测试环境准备

### 1. 设备准备
- Android设备（支持蓝牙4.0+）
- 蓝牙称（支持BLE协议）
- 蓝牙打印机（支持ESC/TSC指令）
- 网络连接（用于API测试）

### 2. 应用准备
- 安装最新版本的JJWeightPrint应用
- 确保已登录并获取到用户权限
- 确保有可用的出库订单数据

## 测试用例

### 测试用例1：无设备模式 (NO_DEVICE)

#### 前置条件
- 不连接任何蓝牙设备
- 确保有可用的出库订单

#### 测试步骤
1. 打开客户出库页面
2. 选择商品进行出库
3. 手动输入重量数据
4. 点击确认出库

#### 预期结果
- 页面标题显示"无设备模式 - 手动输入"
- 可以手动输入重量数据
- 点击确认后直接保存数据到服务器
- 显示"出库成功，共处理 X 个订单"提示
- 数据列表自动刷新

#### 验证点
- [ ] 模式识别正确
- [ ] 手动输入功能正常
- [ ] 数据保存成功
- [ ] 网络请求正常
- [ ] UI反馈正确

### 测试用例2：仅称模式 (SCALE_ONLY)

#### 前置条件
- 连接蓝牙称
- 不连接蓝牙打印机
- 确保有可用的出库订单

#### 测试步骤
1. 打开客户出库页面
2. 等待蓝牙称自动连接
3. 选择商品进行出库
4. 使用蓝牙称称重
5. 点击确认出库

#### 预期结果
- 页面标题显示"仅称模式 - 蓝牙称连接"
- 蓝牙称自动连接成功
- 称重数据自动填充
- 显示手动打印提示对话框
- 用户确认后保存数据到服务器
- 显示"出库成功，请手动打印出库单"提示

#### 验证点
- [ ] 模式识别正确
- [ ] 蓝牙称连接正常
- [ ] 称重数据获取正常
- [ ] 手动打印提示显示正确
- [ ] 数据保存成功
- [ ] 网络请求正常

### 测试用例3：仅打印机模式 (PRINTER_ONLY)

#### 前置条件
- 连接蓝牙打印机
- 不连接蓝牙称
- 确保有可用的出库订单

#### 测试步骤
1. 打开客户出库页面
2. 等待蓝牙打印机自动连接
3. 选择商品进行出库
4. 手动输入重量数据
5. 点击确认出库

#### 预期结果
- 页面标题显示"仅打印机模式 - 蓝牙打印机连接"
- 蓝牙打印机自动连接成功
- 可以手动输入重量数据
- 点击确认后批量打印出库单
- 打印成功后保存数据到服务器
- 显示"出库成功，出库单已打印"提示

#### 验证点
- [ ] 模式识别正确
- [ ] 蓝牙打印机连接正常
- [ ] 手动输入功能正常
- [ ] 批量打印功能正常
- [ ] 数据保存成功
- [ ] 网络请求正常

### 测试用例4：双设备模式 (BOTH_DEVICES)

#### 前置条件
- 同时连接蓝牙称和蓝牙打印机
- 确保有可用的出库订单

#### 测试步骤
1. 打开客户出库页面
2. 等待蓝牙称和打印机自动连接
3. 选择商品进行出库
4. 使用蓝牙称称重
5. 点击确认出库

#### 预期结果
- 页面标题显示"双设备模式 - 蓝牙称和打印机都连接"
- 蓝牙称和打印机都自动连接成功
- 称重数据自动填充
- 点击确认后串行处理：先打印，再保存
- 每个订单单独打印和保存
- 显示"出库成功，共处理 X 个订单"提示

#### 验证点
- [ ] 模式识别正确
- [ ] 双设备连接正常
- [ ] 称重数据获取正常
- [ ] 串行打印和保存正常
- [ ] 数据保存成功
- [ ] 网络请求正常

## 异常测试用例

### 测试用例5：设备连接失败

#### 测试场景
- 蓝牙称连接失败
- 蓝牙打印机连接失败
- 双设备连接失败

#### 测试步骤
1. 模拟设备连接失败
2. 尝试进行出库操作
3. 观察错误处理

#### 预期结果
- 显示相应的错误提示
- 引导用户连接设备
- 阻止无效操作

### 测试用例6：数据验证失败

#### 测试场景
- 订单重量数据为空
- 订单重量数据为0
- 订单重量数据格式错误

#### 测试步骤
1. 准备无效的重量数据
2. 尝试进行出库操作
3. 观察数据验证

#### 预期结果
- 显示数据验证错误提示
- 阻止无效数据提交
- 引导用户补充数据

### 测试用例7：网络请求失败

#### 测试场景
- 网络连接断开
- 服务器接口异常
- 网络超时

#### 测试步骤
1. 模拟网络异常
2. 尝试进行出库操作
3. 观察网络错误处理

#### 预期结果
- 显示网络错误提示
- 提供重试机制
- 保持数据一致性

### 测试用例8：打印失败

#### 测试场景
- 打印机离线
- 打印纸用完
- 打印指令错误

#### 测试步骤
1. 模拟打印异常
2. 尝试进行出库操作
3. 观察打印错误处理

#### 预期结果
- 显示打印错误提示
- 提供手动打印选项
- 不影响数据保存

## 性能测试用例

### 测试用例9：大量订单处理

#### 测试场景
- 处理100个订单
- 处理1000个订单
- 并发处理多个订单

#### 测试步骤
1. 准备大量订单数据
2. 执行出库操作
3. 监控性能指标

#### 预期结果
- 处理时间在可接受范围内
- 内存使用正常
- 不出现ANR或崩溃

### 测试用例10：长时间运行测试

#### 测试场景
- 连续运行2小时
- 频繁切换出库模式
- 频繁连接/断开设备

#### 测试步骤
1. 长时间运行应用
2. 执行各种操作
3. 监控稳定性

#### 预期结果
- 应用稳定运行
- 内存泄漏检查通过
- 设备连接稳定

## 兼容性测试用例

### 测试用例11：不同Android版本

#### 测试场景
- Android 7.0
- Android 8.0
- Android 9.0
- Android 10.0
- Android 11.0

#### 测试步骤
1. 在不同Android版本上安装应用
2. 执行完整的出库流程
3. 检查功能兼容性

#### 预期结果
- 所有功能正常工作
- 权限申请正常
- 蓝牙功能正常

### 测试用例12：不同设备型号

#### 测试场景
- 不同品牌设备
- 不同屏幕尺寸
- 不同硬件配置

#### 测试步骤
1. 在不同设备上测试
2. 检查UI适配
3. 检查功能兼容性

#### 预期结果
- UI显示正常
- 功能正常工作
- 性能表现良好

## 测试执行指南

### 1. 测试环境搭建
```bash
# 安装应用
adb install -r app/build/outputs/apk/debug/app-debug.apk

# 启动应用
adb shell am start -n com.swolo.lpy.pysx/.main.MainActivity

# 查看日志
adb logcat -s CustomerStockOut
```

### 2. 测试数据准备
- 确保有足够的测试订单数据
- 准备不同状态的订单（有重量/无重量）
- 准备不同数量的订单（单个/批量）

### 3. 测试执行顺序
1. 先执行正常流程测试
2. 再执行异常流程测试
3. 最后执行性能和兼容性测试

### 4. 测试结果记录
- 记录每个测试用例的执行结果
- 记录发现的问题和错误
- 记录性能指标数据

### 5. 问题报告
- 详细描述问题现象
- 提供复现步骤
- 附上相关日志信息 